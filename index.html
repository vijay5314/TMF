<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Fitness Tracker</title>


<style>

.overlay {
  background-color: rgba(255, 255, 255, 0.85);
  padding: 20px;
  border-radius: 8px;
}

h2, h3, h4, h5, h6 {
  font-weight: normal;
}

    #welcome-screen {
  text-align: center;
  padding: 80px 20px;
  background-color: #fdfdfd;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  margin: 80px auto;
  max-width: 500px;
}

#welcome-screen h1 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
}

#welcome-screen p {
  font-size: 1rem;
  color: #555;
  margin-bottom: 2rem;
}

#welcome-screen button {
  font-family: 'Courier New', Courier, monospace;
  font-size: 1rem;
  padding: 5px 25px;
  border: none;
  background-color: #4CAF50;
  color: white;
  border-radius: 50px;
  cursor: pointer;
}

#welcome-screen button:hover {
  background-color: #45a049;
}


    body {
      font-family: 'Courier New', Courier, monospace;
      background: #96a6c7;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    h1 {
      text-align: center;
      font-size: 3rem;
      color: #333;
    }

    h2 {
  text-align: center;
  font-size: 2.2rem;
  color: #333;
  word-wrap: break-word;
  }

/* Responsive scaling for small screens */
@media (max-width: 600px) {
  h2 {
    font-size: 1.5rem;
  }
}

    label {
      display: block;
      font-size: 1rem;
      color: #444;
      margin-top: 10px;
      margin-bottom: 2px;
    }

    #bmi-result {
  color: #333;
  background: #fdfdfd;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  max-width: 200px;
}

    .form-group {
      margin-bottom: 1.5rem;
    }

    input[type="number"],
    input[type="date"] {
      font-size: 0.85rem;
      padding: 4px 8px;
      width: 100%;
      max-width: 200px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fafafa;
      box-sizing: border-box;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
     appearance: textfield;
    }

    button {
      font-size: 0.85rem;
      padding: 1px 20px;
      margin-top: 8px;
      background-color: #f0f0f0;
      border: 1px solid #bbb;
      border-radius: 55px;
      cursor: pointer;
    }

    button:hover {
      background-color: #e0e0e0;
    }

    #goal-display {
      background: #e1eddf;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    #entries {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 2rem;
    }

    .entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .entry-buttons {
      display: flex;
      gap: 5px;
    }

    .small-btn {
      font-size: 0.8rem;
      padding: 4px 4px;
      background: #eee;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    .small-btn:hover {
      background-color: #ddd;
    }

body {
  background-image: url('bg.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

    .bmi-box {
  margin-top: 10px;
  margin-bottom: 20px;
  padding: 6px 12px;
  border-radius: 5px;
  font-size: 0.9rem;
  width: fit-content;
  color: white;
}

.bmi-history {
  font-size: 0.85rem;
  padding-left: 1rem;
  color: #222;
}

.bmi-history li {
  margin-bottom: 4px;
}

.bmi-delete-btn {
  font-size: 0.75rem;
  margin-left: 8px;
  background: transparent;
  border: none;
  cursor: pointer;
  color: #888;
}

.bmi-delete-btn:hover {
  color: #f44336;
}

select {
  font-size: 0.85rem;
  padding: 4px 6px;
  margin-top: 4px;
  margin-bottom: 10px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

button {
  transition: background-color 0.2s ease;
}

#goal-display button.small-btn {
  margin-top: 10px;
  margin-left: 5px;
  font-size: 0.75rem;
  padding: 2px 6px;
  background-color: #eee;
  border: 1px solid #bbb;
  border-radius: 15px;
  cursor: pointer;
}

#goal-display button.small-btn:hover {
  background-color: #ddd;
}

#progress-bar-container {
  width: 100%;
  height: 20px;
  background-color: #ddd;
  border-radius: 10px;
  overflow: hidden;
  margin-top: 10px;
}

#progress-bar {
  height: 100%;
  width: 0%;
  background-color: #f44336; /* default red */
  text-align: center;
  color: white;
  font-size: 0.75rem;
  line-height: 20px;
  transition: width 0.4s ease, background-color 0.4s ease;
}
.progress-message {
  margin-top: 10px;
  font-size: 0.95rem;
  text-align: center;
  color: #333;
  opacity: 0;
  transform: translateY(5px);
  transition: opacity 0.4s ease, transform 0.4s ease;
}

.progress-message.show {
  opacity: 1;
  transform: translateY(0);
}

input, button, select {
  touch-action: manipulation;
}

.form-group {
  margin-bottom: 1.2rem;
}

button {
  min-width: 44px;
  min-height: 44px; /* For tap targets on mobile */
}

@media (max-width: 900px) {
  .overlay {
    margin: 0 -10px;
    border-radius: 0;
  }
}

.toggle-btn {
  display: inline-block;
  width: 160px;           /* You can adjust width */
  height: 44px;           /* For mobile-friendly tap target */
  font-size: 0.9rem;
  padding: 10px;
  background-color: #eee;
  border: 1px solid #bbb;
  border-radius: 6px;
  text-align: center;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.toggle-btn:hover {
  background-color: #ddd;
}

@media (max-width: 600px) {
  .toggle-btn {
    width: 100%;
    box-sizing: border-box;
  }
}

/* Fade-in on load */
body {
  opacity: 0;
  transition: opacity 1s ease;
}
body.loaded {
  opacity: 1;
}

/* Soft glow for key containers */
.overlay, #entries, #goal-display, .bmi-box {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

/* Hero-style glass blur effect for welcome screen */
#welcome-screen {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Animated progress bar */
#progress-bar {
  animation: fill-bar 1.2s ease-out;
}
@keyframes fill-bar {
  from {
    width: 0%;
  }
}

/* Animated entry hover */
.entry:hover {
  background-color: #f9f9f9;
  transform: scale(1.01);
  transition: all 0.2s ease;
}

/* Upgraded toggle button style */
.toggle-btn {
  width: 160px;
  height: 44px;
  font-size: 0.9rem;
  background: linear-gradient(135deg, #6ec1e4, #4ca1af);
  color: white;
  border: none;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: background 0.3s ease, transform 0.2s ease;
}
.toggle-btn:hover {
  background: linear-gradient(135deg, #4ca1af, #3b8d99);
  transform: translateY(-2px);
}

.animated-title {
  animation: fadeInUp 1s ease-out;
  opacity: 0;
  transform: translateY(20px);
  animation-fill-mode: forwards;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#progress-bar span {
  display: block;
  font-weight: bold;
  position: relative;
  z-index: 2;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

#dynamic-heading {
  animation: pulse 3s ease-in-out infinite;
  display: inline-block;
  position: relative;
}

.full-center {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 20vh; /* full screen height */
  text-align: center;
}

#weekly-ring-container {
  margin-top: 10px;
}

#weekly-ring {
  transition: stroke-dashoffset 0.6s ease;
}

#goal-details {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, opacity 0.4s ease;
  opacity: 0;
}

#goal-details.open {
  max-height: 200px;
  opacity: 1;
}

  </style>
</head>

<body>
<div class="overlay">
<div id="welcome-screen"> 
  <h1 class="animated-title">Welcome to TrackMyFitness¬©Ô∏è</h1>
  <p>Your personal health and weight progress companion.</p>
  <button onclick="enterApp()">Start Tracking</button>
</div>

<div id="app-screen" style="display: none;">
  <!-- your current content here -->

  <div class="full-center">
  <h2 id="dynamic-heading">TrackMyFitness¬©Ô∏è</h2>
</div>

  <div id="goal-input-section" class="form-group">
  <label for="goal">Set Your Goal Weight (kg):</label>
  <input type="number" id="goal" placeholder="e.g. 65">
  <button onclick="saveGoal()">Save Goal</button>
</div>

<div id="goal-display">
  <div id="goal-summary" style="text-align: center; font-size: 2.2rem; font-weight: bold; margin-bottom: 0.5rem;">
    üéØ <span id="goal-weight-text">-- kg</span>
  </div>

  <button class="toggle-btn" onclick="toggleGoalDetails(event)">More Info ‚Üì</button>

  <div id="goal-details" style="display: none; margin-top: 10px; font-size: 1rem; text-align: center;">
    <div id="goal-diff-text"></div>
    <button class="small-btn" onclick="editGoal()">‚úèÔ∏è Edit Goal</button>
  </div>
</div>


<div id="progress-bar-container">
  <div id="progress-bar">
    <span id="progress-number">0%</span>
  </div>
</div>

<div id="progress-message" class="progress-message"></div>

<!-- Weekly Goal Setup Section -->
<div id="weekly-goal-section" style="display: none; padding: 10px; background: #f9f9f9; border-radius: 8px; margin-bottom: 15px;">
  <label for="weekly-goal">Weekly Goal Change (kg):</label>
  <input type="number" id="weekly-goal" placeholder="-1.0 for loss or 1.0 for gain">

  <label for="weekly-start-date">Start Date:</label>
  <input type="date" id="weekly-start-date">

  <div id="weekly-end-date" style="margin-top: 8px; margin-bottom: 8px; font-size: 0.9rem; color: #555;"></div>

  <button onclick="saveWeeklyGoal()">‚úÖ Save Weekly Goal</button>
</div>

<div id="weekly-progress" class="bmi-box" style="background-color: #fff; color: #333;"></div>

<div id="weekly-ring-container" style="display: flex; justify-content: center; align-items: center; margin-top: 10px;">
  <svg width="90" height="90" viewBox="0 0 100 100">
    <circle
      cx="50" cy="50" r="45"
      stroke="#eee"
      stroke-width="10"
      fill="none"
    />
    <circle
      id="weekly-ring"
      cx="50" cy="50" r="45"
      stroke="#4caf50"
      stroke-width="10"
      fill="none"
      stroke-linecap="round"
      stroke-dasharray="282.6"
      stroke-dashoffset="282.6"
      transform="rotate(-90 50 50)"
    />
    <text
      id="weekly-ring-label"
      x="50%" y="54%"
      text-anchor="middle"
      fill="#333"
      font-size="16px"
      font-weight="bold"
    >0%</text>
  </svg>
</div>

<div class="form-group">
  <button onclick="toggleWeeklyGoal()" id="weekly-goal-toggle" class="toggle-btn">Show Weekly Goal</button>
</div>

<div class="form-group">
  <button onclick="toggleWeeklyHistory()" class="toggle-btn" id="history-toggle-btn">Show Weekly History</button>
</div>

<div id="weekly-history-section" style="display: none;">
  <h3>üìö Weekly Summaries</h3>
  <ul id="weekly-history-list" class="bmi-history"></ul>
  <div style="margin-top: 10px;">
    <button onclick="resetWeeklyHistory()" class="toggle-btn">üóë Reset Weekly History</button>
  </div>
</div>

<button onclick="toggleWeightForm()" class="toggle-btn">Add Weight</button>

<div id="add-weight-section" class="form-group" style="display: none;">
  <label for="date">Date:</label>
  <input type="date" id="date">

  <label for="weight">Weight (kg):</label>
  <input type="number" id="weight" placeholder="Enter your weight">

  <button onclick="addOrUpdateEntry()">‚ûï</button>
</div>

  <div class="form-group">
  <button onclick="toggleBMISection()" class="toggle-btn">BMI Calculator</button>
</div>


<div id="bmi-section" style="display: none;">
  <label for="height">Height (cm):</label>
  <input type="number" id="height" placeholder="Enter your height">

  <button onclick="calculateBMI()">Calculate BMI</button>
  <div id="bmi-result" class="bmi-box"></div>

  <h3 style="margin-top: 1.5rem;">BMI History</h3>
  <ul id="bmi-history" class="bmi-history"></ul>

<label for="activity">Activity Level:</label>
<select id="activity" onchange="calculateBMI()">
  <option value="1.2">Sedentary (little or no exercise)</option>
  <option value="1.375">Lightly active (1‚Äì3 days/week)</option>
  <option value="1.55">Moderately active (3‚Äì5 days/week)</option>
  <option value="1.725">Very active (6‚Äì7 days/week)</option>
  <option value="1.9">Super active (physical job or 2√ó training)</option>
</select>
<div id="calorie-results" class="bmi-box" style="margin-top: 10px;"></div>
</div>

  <div class="form-group">
  <button onclick="toggleEntries()" class="toggle-btn">Show Your Records</button>
</div>

  <div id="entries" style="display: none;">
    <h3>Your Record</h3>
    <div id="entry-list"></div>
  </div>
  </div>
</div>

<script>

document.addEventListener('DOMContentLoaded', () => {
  // Always show welcome screen on load
  document.getElementById('welcome-screen').style.display = 'block';
  document.getElementById('app-screen').style.display = 'none';

  // Still load goal for progress bar/bmi tracking later
  goalWeight = parseFloat(localStorage.getItem('goalWeight')) || null;
  updateGoalMessage();
  displayEntries();
  displayBMIHistory();
  updateWeeklyProgress();
  displayWeeklyHistory();
});

function enterApp() {
  document.getElementById('welcome-screen').style.display = 'none';
  document.getElementById('app-screen').style.display = 'block';
}

let goalWeight = parseFloat(localStorage.getItem('goalWeight')) || null;

    const entryList = document.getElementById('entry-list');
    const goalInput = document.getElementById('goal');
    const goalDisplay = document.getElementById('goal-display');
    const dateInput = document.getElementById('date');
    const weightInput = document.getElementById('weight');

    let entries = JSON.parse(localStorage.getItem('entries')) || [];
    
    let chart;
    let editingIndex = null;

function saveGoal() {
      const goalInput = document.getElementById('goal');
      const goal = parseFloat(goalInput.value);
      if (isNaN(goal)) {
        alert("Please enter a valid goal weight.");
        return;
      }
      goalWeight = goal;
      localStorage.setItem('goalWeight', goalWeight);
      loadGoal();
      updateGoalMessage();
      goalInput.value = '';
    document.getElementById('goal-input-section').style.display = 'none';
}

function editGoal() {
     document.getElementById('goal-input-section').style.display = 'block';
}

function loadGoal() {
     goalWeight = parseFloat(localStorage.getItem('goalWeight')) || null;
     updateGoalMessage();
 }


function updateGoalMessage() {
      const goalText = document.getElementById('goal-weight-text');
      const diffText = document.getElementById('goal-diff-text');
      const goalInputSection = document.getElementById('goal-input-section');
      const goalDetails = document.getElementById('goal-details');

      if (goalWeight) {
        goalInputSection.style.display = 'none';
        goalText.textContent = `${goalWeight} kg`;

        if (entries.length === 0) {
          diffText.innerHTML = `No weight entries yet.`;
        } else {
          const sorted = [...entries].sort((a, b) => new Date(a.date) - new Date(b.date));
          const latest = sorted[sorted.length - 1].weight;
          const diff = (latest - goalWeight).toFixed(1);

          if (diff > 0) {
            diffText.innerHTML = `üìà ${diff} kg <strong>above</strong> your goal`;
          } else if (diff < 0) {
            diffText.innerHTML = `üìâ ${Math.abs(diff)} kg <strong>below</strong> your goal`;
          } else {
            diffText.innerHTML = `‚úÖ You've reached your goal!`;
          }
        }

        // Show edit button regardless of weight entry state
        goalDetails.style.display = 'block';

      } else {
        goalInputSection.style.display = 'block';
        goalText.textContent = '-- kg';
        diffText.innerHTML = `Goal not set yet.`;
        goalDetails.style.display = 'none';
      }
    }


function toggleGoalDetails(event) {
      const section = document.getElementById('goal-details');
      const btn = event.target;
      const isVisible = section.classList.contains('open');

      section.classList.toggle('open');
      btn.textContent = isVisible ? 'More Info ‚Üì' : 'Less Info ‚Üë';
    }

  // -------- Progress bar logic --------
  const progressBar = document.getElementById('progress-bar');
  const messageBox = document.getElementById('progress-message');
  let motivation = '';

if (goalWeight && entries.length > 0) {
const sorted = [...entries].sort((a, b) => new Date(a.date) - new Date(b.date));
const first = sorted[0].weight;
const latest = sorted[sorted.length - 1].weight;

let percent = 0;
const totalChange = goalWeight - first;
const currentChange = latest - first;

if (totalChange === 0) {
  percent = 100;
} else {
  percent = (currentChange / totalChange) * 100;
}

percent = Math.max(0, Math.min(100, percent)).toFixed(1);
const p = parseFloat(percent);

// Update progress bar
  const progressBar = document.getElementById('progress-bar');
  progressBar.style.width = `${percent}%`;
  animateNumber('progress-number', parseInt(percent));

// Color logic and motivation
  const messageBox = document.getElementById('progress-message');
  let motivation = "";

  if (p < 30) {
    progressBar.style.backgroundColor = '#f44336';
    motivation = "Let‚Äôs get started!";
  } else if (p < 60) {
    progressBar.style.backgroundColor = '#ff9800';
    motivation = "Keep going!";
  } else if (p < 80) {
    progressBar.style.backgroundColor = '#ffeb3b';
    progressBar.style.color = '#000';
    motivation = "You're doing great!";
  } else if (p < 100) {
    progressBar.style.backgroundColor = '#4caf50';
    motivation = "You're so close!";
  } else if (p === 100) {
    progressBar.style.backgroundColor = '#00e676';
    motivation = "You did it! üéâ";
  }

// Animate motivational message
    messageBox.classList.remove('show');
    setTimeout(() => {
      messageBox.textContent = motivation;
      messageBox.classList.add('show');
    }, 100);

// Animate message update
messageBox.classList.remove('show'); // reset animation
setTimeout(() => {
  messageBox.textContent = motivation;
  messageBox.classList.add('show');
}, 100);
  }

    document.addEventListener('DOMContentLoaded', () => {
      goalWeight = parseFloat(localStorage.getItem('goalWeight')) || null;
      if (goalWeight !== null) {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'block';
      }
      updateGoalMessage();
    });

    function saveEntries() {
      localStorage.setItem('entries', JSON.stringify(entries));
    }

    function displayEntries() {
      entryList.innerHTML = '';
      entries.slice().reverse().forEach((entry, i) => {
        const trueIndex = entries.length - 1 - i;
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
          ${entry.date}: ${entry.weight} kg
          <span class="entry-buttons">
            <button class="small-btn" onclick="startEdit(${trueIndex})">‚úèÔ∏è</button>
            <button class="small-btn" onclick="deleteEntry(${trueIndex})">üóëÔ∏è</button>
          </span>
        `;
        entryList.appendChild(div);
      });
    }

    function addOrUpdateEntry() {
      const date = dateInput.value;
      const weight = parseFloat(weightInput.value);

      if (!date || isNaN(weight)) {
        alert("Please enter both a valid date and weight.");
        return;
      }

      if (editingIndex !== null) {
        const isDuplicate = entries.some((e, i) => i !== editingIndex && e.date === date);
        if (isDuplicate) {
          alert("Another entry already exists for that date.");
          return;
        }

        entries[editingIndex] = { date, weight };
        editingIndex = null;
        document.querySelector("button[onclick='addOrUpdateEntry()']").textContent = "Add Entry";
      } else {
        const duplicate = entries.some(entry => entry.date === date);
        if (duplicate) {
          alert("You've already entered a weight for this date. Use edit instead.");
          return;
        }

        entries.push({ date, weight });
      }

      saveEntries();
      displayEntries();
      updateGoalMessage();
      updateWeeklyProgress();
      updateGoalMessage();
      dateInput.value = '';
      weightInput.value = '';
    }

    function deleteEntry(index) {
      if (confirm("Are you sure you want to delete this entry?")) {
        entries.splice(index, 1);
        saveEntries();
        displayEntries();
        updateGoalMessage();
      }
    }

    function startEdit(index) {
      const entry = entries[index];
      dateInput.value = entry.date;
      weightInput.value = entry.weight;
      editingIndex = index;

      const addBtn = document.querySelector("button[onclick='addOrUpdateEntry()']");
      addBtn.textContent = "Save Changes";
    }

    // Initialize
    displayEntries();
    if (entries.length > 0)
    updateGoalMessage();

    window.startEdit = startEdit;
    window.deleteEntry = deleteEntry;

    let bmiLog = JSON.parse(localStorage.getItem('bmiHistory')) || [];

function toggleBMISection() {
  const section = document.getElementById('bmi-section');
  section.style.display = section.style.display === 'none' ? 'block' : 'none';
}

function calculateBMI() {
  const weight = parseFloat(weightInput.value);
  const height = parseFloat(document.getElementById('height').value);
  const activityMultiplier = parseFloat(document.getElementById('activity').value);

  if (isNaN(weight) || isNaN(height) || height === 0) {
    alert("Please enter both weight and height.");
    return;
  }

  const heightInMeters = height / 100;
  const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(1);

  let category = '';
  let color = '';
  if (bmi < 18.5) {
    category = 'Underweight';
    color = '#87CEEB';
  } else if (bmi < 25) {
    category = 'Normal';
    color = '#4CAF50';
  } else if (bmi < 30) {
    category = 'Overweight';
    color = '#FF9800';
  } else {
    category = 'Obese';
    color = '#F44336';
  }

  const resultBox = document.getElementById('bmi-result');
  resultBox.textContent = `Your BMI is ${bmi} (${category})`;
  resultBox.style.backgroundColor = color;

  // Estimate BMR using Mifflin-St Jeor (gender-neutral estimate)
  const bmr = 10 * weight + 6.25 * height - 5 * 30; // assuming age ~30
  const tdee = Math.round(bmr * activityMultiplier);

  const maintain = tdee;
  const lose = tdee - 500;
  const gain = tdee + 500;

  const calorieBox = document.getElementById('calorie-results');
  calorieBox.innerHTML = `
    <strong>Estimated Daily Calories:</strong><br>
    üîµ Maintain: ${maintain} kcal/day<br>
    üü¢ Lose: ${lose} kcal/day<br>
    üî¥ Gain: ${gain} kcal/day
  `;
  calorieBox.style.backgroundColor = '#474';

  // Save BMI entry
  const date = new Date().toLocaleDateString();
  const entry = `${date}: BMI ${bmi} (${category})`;
  bmiLog.push(entry);
  localStorage.setItem('bmiHistory', JSON.stringify(bmiLog));
  displayBMIHistory();
}

function displayBMIHistory() {
  const list = document.getElementById('bmi-history');
  list.innerHTML = '';
  bmiLog.slice().reverse().forEach((entry, i) => {
    const trueIndex = bmiLog.length - 1 - i; // correct index when reversed
    const li = document.createElement('li');
    li.innerHTML = `
      ${entry}
      <button onclick="deleteBMIEntry(${trueIndex})" class="bmi-delete-btn">üóëÔ∏è</button>
    `;
    list.appendChild(li);
  });
}

function deleteBMIEntry(index) {
  if (confirm("Delete this BMI entry?")) {
    bmiLog.splice(index, 1);
    localStorage.setItem('bmiHistory', JSON.stringify(bmiLog));
    displayBMIHistory();
  }
}

// Initialize BMI history display on page load
displayBMIHistory();

function toggleEntries() {
  const entriesSection = document.getElementById('entries');
  const button = event.target;

  const isVisible = entriesSection.style.display !== 'none';

  if (isVisible) {
    entriesSection.style.display = 'none';
    button.textContent = "Show Your Records ‚Üì";
  } else {
    entriesSection.style.display = 'block';
    button.textContent = "Hide Records";
  }
}

function toggleWeightForm() {
  const section = document.getElementById('add-weight-section');
  section.style.display = section.style.display === 'none' ? 'block' : 'none';
}

window.addEventListener('load', () => {
  document.body.classList.add('loaded');
});

function animateNumber(elementId, target, duration = 1000) {
  const el = document.getElementById(elementId);
  const start = 0;
  const range = target - start;
  const stepTime = Math.max(Math.floor(duration / range), 20);

  let startTime = null;

  function update(timestamp) {
    if (!startTime) startTime = timestamp;
    const progress = timestamp - startTime;
    const value = Math.min(start + (range * (progress / duration)), target);
    el.textContent = Math.round(value) + '%';

    if (value < target) {
      requestAnimationFrame(update);
    } else {
      el.textContent = target + '%';
    }
  }

  requestAnimationFrame(update);
}

let weeklyGoal = parseFloat(localStorage.getItem('weeklyGoal')) || null;
let weeklyHistory = JSON.parse(localStorage.getItem('weeklyHistory')) || [];

function saveWeeklyGoal() {
  const goal = parseFloat(document.getElementById('weekly-goal').value);
  const startDate = document.getElementById('weekly-start-date').value;

  if (isNaN(goal) || !startDate) {
    alert("Please enter a valid weekly goal and start date.");
    return;
  }

  // Save to localStorage
  weeklyGoal = goal;
  localStorage.setItem('weeklyGoal', goal);
  localStorage.setItem('weeklyStartDate', startDate);

  // Auto-calculate end date
  const start = new Date(startDate);
  const end = new Date(start);
  end.setDate(end.getDate() + 7);
  localStorage.setItem('weeklyEndDate', end.toISOString().split('T')[0]);

  updateWeeklyProgress();
  displayWeeklyHistory();

  alert("Weekly goal saved!");
  document.getElementById('weekly-goal-section').style.display = 'none';
  document.getElementById('weekly-goal-toggle').textContent = "Show Weekly Goal ‚Üì";
}

function toggleWeeklyGoal() {
  const section = document.getElementById('weekly-goal-section');
  const toggleBtn = document.getElementById('weekly-goal-toggle');

  if (section.style.display === 'none') {
    section.style.display = 'block';
    toggleBtn.textContent = "Hide Weekly Goal";
  } else {
    section.style.display = 'none';
    toggleBtn.textContent = "Show Weekly Goal";
  }
}

document.getElementById('weekly-start-date').addEventListener('change', () => {
  const start = new Date(document.getElementById('weekly-start-date').value);
  if (!isNaN(start)) {
    const end = new Date(start);
    end.setDate(end.getDate() + 7);
    document.getElementById('weekly-end-date').textContent = `End Date: ${end.toISOString().split('T')[0]}`;
  }
});

function updateWeeklyProgress() {
  const box = document.getElementById('weekly-progress');
  const startDateStr = localStorage.getItem('weeklyStartDate');
  const endDateStr = localStorage.getItem('weeklyEndDate');

  if (!startDateStr || !endDateStr) {
  box.textContent = "Weekly goal not set.";
  return;
  }

  const today = new Date();
  const startDate = new Date(startDateStr);
  const endDate = new Date(endDateStr);
  const startEntry = weekEntries[0];
  const latestEntry = weekEntries[weekEntries.length - 1];
  
  if (today > endDate) { 
    // Save history, reset
    if (startEntry && latestEntry) {
    const change = (latestEntry.weight - startEntry.weight).toFixed(1);
    const metGoal = weeklyGoal < 0
      ? change <= weeklyGoal
      : change >= weeklyGoal;

      weeklyHistory.push({
      weekNumber: weeklyHistory.length + 1,
      startDate: startDateStr,
      endDate: endDateStr,
      change,
      goal: weeklyGoal,
      met: metGoal
      });

    localStorage.setItem('weeklyHistory', JSON.stringify(weeklyHistory));
  }

  // Reset
  localStorage.removeItem('weeklyStartDate');
  localStorage.removeItem('weeklyEndDate');
  box.textContent = "New week not set yet. Set your next goal!";
  displayWeeklyHistory();
  return;
}

  // Get weights for the current week
  const sorted = [...entries].sort((a, b) => new Date(a.date) - new Date(b.date));
  const weekEntries = sorted.filter(e => {
  const d = new Date(e.date);
  return d >= startDate && d <= endDate;
});

if (weekEntries.length < 2) {
  box.textContent = "Not enough data this week to calculate progress.";
  box.style.backgroundColor = "#eee";
  return;
}



  const change = (latestEntry.weight - startEntry.weight).toFixed(1);
  const goal = weeklyGoal;

  let message = `üìÖ Weekly change since ${startDateStr}: ${change} kg\n`;

  if (goal < 0) {
    if (change <= goal) {
      message += `‚úÖ Goal met! You lost ${Math.abs(change)} kg üéâ`;
      box.style.backgroundColor = "#c8e6c9";
    } else if (change < 0) {
      message += `‚è≥ You're losing, but not at goal yet. Keep going! üí™`;
      box.style.backgroundColor = "#fff9c4";
    } else {
      message += `‚ö†Ô∏è You gained ${change} kg. Let's refocus.`;
      box.style.backgroundColor = "#ffcdd2";
    }
  } else {
    if (change >= goal) {
      message += `‚úÖ Goal met! You gained ${change} kg üéâ`;
      box.style.backgroundColor = "#c8e6c9";
    } else if (change > 0) {
      message += `‚è≥ You're gaining, but under target. Almost there!`;
      box.style.backgroundColor = "#fff9c4";
    } else {
      message += `‚ö†Ô∏è You lost ${Math.abs(change)} kg. Check your intake.`;
      box.style.backgroundColor = "#ffcdd2";
    }
  }

  box.textContent = message;
  
  //Update ring
  let weeklyPercent = 0;
  if (weeklyGoal !== 0) {
  weeklyPercent = (change / weeklyGoal) * 100;
}

// Cap between 0 and 100 for ring display
const boundedPercent = Math.max(0, Math.min(100, Math.abs(weeklyPercent.toFixed(1))));

// Update ring and label
document.getElementById('weekly-ring-label').textContent = `${boundedPercent}%`;
updateWeeklyRing(boundedPercent);
}

function displayWeeklyHistory() {
  const list = document.getElementById('weekly-history-list');
  list.innerHTML = '';

  if (weeklyHistory.length === 0) {
    list.innerHTML = '<li>No past weekly summaries yet.</li>';
    return;
  }

  weeklyHistory.slice().reverse().forEach(week => {
    const li = document.createElement('li');
    li.textContent = `üìò Week ${week.weekNumber}: ${week.startDate} ‚Üí ${week.endDate} | Change: ${week.change} kg | Goal: ${week.goal} | ${week.met ? '‚úÖ Met' : '‚ùå Missed'}`;
    list.appendChild(li);
  });
}

function toggleWeeklyHistory() {
  const section = document.getElementById('weekly-history-section');
  const button = document.getElementById('history-toggle-btn');

  const isVisible = section.style.display !== 'none';
  section.style.display = isVisible ? 'none' : 'block';
  button.textContent = isVisible ? 'Show Weekly History' : 'Hide Weekly History';
}

function resetWeeklyHistory() {
  if (confirm("Are you sure you want to clear all weekly history?")) {
    localStorage.removeItem('weeklyHistory');
    weeklyHistory = [];
    displayWeeklyHistory();
    alert("Weekly history cleared.");
  }
}

function updateWeeklyRing(percent) {
  const circumference = 2 * Math.PI * 35; // 2œÄr where r=35
  const offset = circumference - (percent / 100) * circumference;
  const ring = document.getElementById('weekly-ring');
  ring.style.strokeDashoffset = offset;
}

function editGoal() {
      document.getElementById('goal-input-section').style.display = 'block';
    }

  </script>
</body>
</html>